@model HairCareShop.Web.ViewModels.DashboardViewModel
@{
    ViewData["Title"] = "Trang chủ Admin";
    var culture = new System.Globalization.CultureInfo("vi-VN");
}

<div class="container-fluid p-4">
    <h2 class="mb-4 font-weight-bold text-dark">🚀 Tổng Quan Kinh Doanh</h2>

    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3 shadow-sm h-100">
                <div class="card-body">
                    <h6 class="card-title text-uppercase">Doanh thu hôm nay</h6>
                    <h3 class="card-text font-weight-bold">@Model.DailyRevenue.ToString("C0", culture)</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3 shadow-sm h-100">
                <div class="card-body">
                    <h6 class="card-title text-uppercase">Doanh thu tháng này</h6>
                    <h3 class="card-text font-weight-bold">@Model.MonthlyRevenue.ToString("C0", culture)</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning mb-3 shadow-sm h-100">
                <div class="card-body">
                    <h6 class="card-title text-uppercase text-white">Đơn hàng mới</h6>
                    <h3 class="card-text font-weight-bold text-white">@Model.NewOrdersToday đơn</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-info mb-3 shadow-sm h-100">
                <div class="card-body">
                    <h6 class="card-title text-uppercase">Tổng sản phẩm</h6>
                    <h3 class="card-text font-weight-bold">@Model.TotalProducts</h3>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-header bg-white font-weight-bold">
                    📈 Biểu đồ doanh thu 6 tháng gần nhất
                </div>
                <div class="card-body">
                    <canvas id="revenueChart" style="max-height: 350px;"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-white font-weight-bold">
                    📦 Tỷ lệ đơn hàng
                </div>
                <div class="card-body">
                    <canvas id="statusChart" style="max-height: 250px;"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-white font-weight-bold text-danger">
            🏆 Top 5 Sản phẩm bán chạy nhất
        </div>
        <div class="card-body p-0">
            <table class="table table-hover mb-0">
                <thead class="thead-light">
                    <tr>
                        <th>Sản phẩm</th>
                        <th class="text-center">Số lượng bán</th>
                        <th class="text-right">Tổng thu</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.TopSellingProducts)
                    {
                        <tr>
                            <td>
                                @if (!string.IsNullOrEmpty(item.ImageUrl))
                                {
                                    <img src="@item.ImageUrl"
                                        style="width: 40px; height: 40px; object-fit: cover; border-radius: 5px; border: 1px solid #eee;" />
                                }
                                else
                                {
                                    <span class="badge badge-secondary">No Image</span>
                                }
                                <span class="ml-2 font-weight-bold">@item.ProductName</span>
                            </td>
                            <td class="text-center">
                                <span class="badge badge-primary p-2" style="font-size: 14px;">@item.SoldQuantity</span>
                            </td>
                            <td class="text-right font-weight-bold text-success">
                                @item.TotalRevenue.ToString("N0") đ
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // 1. Biểu đồ Doanh thu (Cột)
    var ctxRev = document.getElementById('revenueChart').getContext('2d');
    new Chart(ctxRev, {
        type: 'bar',
        data: {
            labels: @Html.Raw(Json.Serialize(Model.MonthLabels)),
            datasets: [{
                label: 'Doanh thu (VNĐ)',
                data: @Html.Raw(Json.Serialize(Model.RevenueLast12Months)),
                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1,
                borderRadius: 5
            }]
        },
        options: {
            responsive: true,
            scales: { y: { beginAtZero: true } }
        }
    });

    // 2. Biểu đồ Trạng thái (Tròn)
    var ctxStatus = document.getElementById('statusChart').getContext('2d');
    new Chart(ctxStatus, {
        type: 'doughnut',
        data: {
            labels: ['Chờ xác nhận', 'Đang giao', 'Hoàn thành', 'Đã hủy'],
            datasets: [{
                data: [
                    @Model.PendingCount,
                    @Model.ShippingCount,
                    @Model.CompletedCount,
                    @Model.CancelledCount
                ],
                backgroundColor: [
                    '#ffc107', // Vàng
                    '#17a2b8', // Xanh dương
                    '#28a745', // Xanh lá
                    '#dc3545'  // Đỏ
                ],
                hoverOffset: 4
            }]
        }
    });
</script>